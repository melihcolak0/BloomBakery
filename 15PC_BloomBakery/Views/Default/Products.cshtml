@model List<ResultProductDto>

@{
    Layout = null;

    // Güvenli hazırlık: null kontrolü ve tip dönüşümü
    var selectedCategory = (ViewBag.SelectedCategory ?? "").ToString();
    var categories = (ViewBag.Categories as IEnumerable<string>) ?? Enumerable.Empty<string>();
    var minPriceVal = ViewBag.MinPrice ?? "";
    var maxPriceVal = ViewBag.MaxPrice ?? "";
}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Bloom Bakery</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="" name="keywords">
    <meta content="" name="description">

    <!-- Favicon -->
    <link href="/baker-1.0.0/img/favicon.ico" rel="icon">

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">

    <!-- Icon Font Stylesheet -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Libraries Stylesheet -->
    <link href="/baker-1.0.0/lib/animate/animate.min.css" rel="stylesheet">
    <link href="/baker-1.0.0/lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">

    <!-- Customized Bootstrap Stylesheet -->
    <link href="/baker-1.0.0/css/bootstrap.min.css" rel="stylesheet">

    <!-- Template Stylesheet -->
    <link href="/baker-1.0.0/css/style.css" rel="stylesheet">

    <style>
        .price-slider-container {
            padding: 20px;
            position: relative;
        }

        .range-slider {
            position: relative;
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            margin: 30px 0;
        }

            .range-slider .progress {
                position: absolute;
                height: 100%;
                background: #0d6efd;
                border-radius: 3px;
            }

        .range-input {
            position: relative;
        }

            .range-input input {
                position: absolute;
                width: 100%;
                height: 6px;
                background: none;
                pointer-events: none;
                -webkit-appearance: none;
                -moz-appearance: none;
                top: -12px;
            }

                .range-input input::-webkit-slider-thumb {
                    height: 20px;
                    width: 20px;
                    border-radius: 50%;
                    background: #0d6efd;
                    pointer-events: auto;
                    -webkit-appearance: none;
                    cursor: pointer;
                    border: 2px solid white;
                    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
                }

                .range-input input::-moz-range-thumb {
                    height: 20px;
                    width: 20px;
                    border-radius: 50%;
                    background: #0d6efd;
                    pointer-events: auto;
                    -moz-appearance: none;
                    cursor: pointer;
                    border: 2px solid white;
                    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
                }

        .price-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }

        .price-label {
            font-size: 14px;
            font-weight: 600;
            color: #495057;
            background: #f8f9fa;
            padding: 5px 12px;
            border-radius: 4px;
        }
    </style>

</head>

<body>
    <!-- Spinner Start -->
    <div id="spinner" class="show bg-white position-fixed translate-middle w-100 vh-100 top-50 start-50 d-flex align-items-center justify-content-center">
        <div class="spinner-grow text-primary" role="status"></div>
    </div>
    <!-- Spinner End -->
    <div class="container-fluid top-bar bg-dark text-light px-0 wow fadeIn" data-wow-delay="0.1s">
        <div class="row gx-0 align-items-center d-none d-lg-flex">
            <div class="col-lg-6 px-5 text-start">
                <ol class="breadcrumb mb-0">
                    <li class="breadcrumb-item"><a class="small text-light" href="/Default/Index">Ana Sayfa</a></li>
                    <li class="breadcrumb-item"><a class="small text-light" href="/About/Index">Geliştirme Paneli</a></li>
                </ol>
            </div>
            <div class="col-lg-6 px-5 text-end">
                <small>Bizi takip edin:</small>
                <div class="h-100 d-inline-flex align-items-center">
                    <a class="btn-lg-square text-primary border-end rounded-0" href=""><i class="fab fa-facebook-f"></i></a>
                    <a class="btn-lg-square text-primary border-end rounded-0" href=""><i class="fab fa-twitter"></i></a>
                    <a class="btn-lg-square text-primary border-end rounded-0" href=""><i class="fab fa-linkedin-in"></i></a>
                    <a class="btn-lg-square text-primary pe-0" href=""><i class="fab fa-instagram"></i></a>
                </div>
            </div>
        </div>
    </div>
    <!-- Topbar End -->
    <!-- Navbar Start -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top py-lg-0 px-lg-5 wow fadeIn" data-wow-delay="0.1s">
        <a href="/Default/Index" class="navbar-brand ms-4 ms-lg-0">
            <h1 class="text-primary m-0">Bloom Bakery</h1>
        </a>
        <button type="button" class="navbar-toggler me-4" data-bs-toggle="collapse" data-bs-target="#navbarCollapse">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarCollapse">
            <div class="navbar-nav mx-auto p-4 p-lg-0">
                <a href="/Default/Index" class="nav-item nav-link">Ana Sayfa</a>
                <a href="#" class="nav-item nav-link">Hakkımızda</a>
                <a href="#" class="nav-item nav-link">Hizmetler</a>
                <a href="#" class="nav-item nav-link active">Ürünler</a>
                <a href="#" class="nav-item nav-link">İletişim</a>
            </div>
            <div class=" d-none d-lg-flex">
                <div class="flex-shrink-0 btn-lg-square border border-light rounded-circle">
                    <i class="fa fa-phone text-primary"></i>
                </div>
                <div class="ps-3">
                    <small class="text-primary mb-0">Bize Ulaşın</small>
                    <p class="text-light fs-5 mb-0">+123 456 78 90</p>
                </div>
            </div>
        </div>
    </nav>
    <!-- Navbar End -->
    <!-- Page Header Start -->
    <div class="container-fluid page-header py-6 wow fadeIn" data-wow-delay="0.1s">
        <div class="container text-center pt-5 pb-3">
            <h1 class="display-4 text-white animated slideInDown mb-3">Ürünlerimiz</h1>
            <nav aria-label="breadcrumb animated slideInDown">
                <ol class="breadcrumb justify-content-center mb-0">
                    <li class="breadcrumb-item"><a class="text-white" href="/Default/Index">Ana Sayfa</a></li>
                    <li class="breadcrumb-item text-primary active" aria-current="page">Ürünler</li>
                </ol>
            </nav>
        </div>
    </div>
    <!-- Page Header End -->
    <!-- Product Start -->


    <!-- 🔹 Filtreleme Formu -->
    <div class="container my-5">
        <form method="get" asp-controller="Default" asp-action="Products" class="bg-white p-4 rounded shadow-sm" id="filterForm">
            <div class="row g-3 justify-content-center">
                <!-- Kategori Filtreleme -->
                <div class="col-md-4">
                    <label class="form-label fw-semibold">Kategori</label>
                    <select name="category" class="form-select" onchange="this.form.submit()">
                        <option value="" selected="@(string.IsNullOrEmpty(selectedCategory))">Tümü</option>
                        @foreach (var cat in categories)
                        {
                            <option value="@cat" selected="@(string.Equals(selectedCategory, cat, StringComparison.OrdinalIgnoreCase))">@cat</option>
                        }
                    </select>
                </div>

                <!-- Fiyat Aralığı Slider -->
                <div class="col-md-8">
                    <label class="form-label fw-semibold">Fiyat Aralığı</label>
                    <div class="price-slider-container">
                        <div class="range-slider">
                            <div class="progress" id="progress"></div>
                        </div>
                        <div class="range-input">
                            <input type="range" id="rangeMin" min="0" max="50" value="@(minPriceVal ?? 0)" step="1">
                            <input type="range" id="rangeMax" min="0" max="50" value="@(maxPriceVal ?? 50)" step="1">
                        </div>
                        <div class="price-labels">
                            <span class="price-label">Min: <span id="minPrice">@(minPriceVal ?? 0)</span> ₺</span>
                            <span class="price-label">Max: <span id="maxPrice">@(maxPriceVal ?? 50)</span> ₺</span>
                        </div>
                    </div>
                    <input type="hidden" name="minPrice" id="minPriceInput" value="@(minPriceVal ?? 0)">
                    <input type="hidden" name="maxPrice" id="maxPriceInput" value="@(maxPriceVal ?? 50)">
                </div>

                <!-- Filtrele Butonu -->
                <div class="col-md-12 text-center mt-3">
                    <button type="submit" class="btn btn-primary px-5">Filtrele</button>
                </div>
            </div>
        </form>
    </div>   

    <!-- 🔹 Ürün Listesi -->
    <div class="container-xxl bg-light my-6 py-6 pt-0">
        <div class="container">
            <div class="text-center mx-auto mb-5" style="max-width: 600px;">
                <br /> <br />
                <h1 class="fw-bold fs-2 mb-3 lh-base text-dark">
                    Tatlısından Tuzlusuna, Her Damak Zevkine Göre Ürünlerimiz
                </h1>
                <div class="mx-auto bg-primary" style="width: 60px; height: 3px;"></div>
            </div>
            <div class="row g-4">
                @if (!Model.Any())
                {
                    <div class="text-center text-muted">Aradığınız kriterlere uygun ürün bulunamadı.</div>
                }
                else
                {
                    @foreach (var item in Model)
                    {
                        <div class="col-lg-4 col-md-6 wow fadeInUp" data-wow-delay="0.1s">
                            <div class="product-item d-flex flex-column bg-white rounded overflow-hidden h-100">
                                <div class="text-center p-4">
                                    <div class="d-inline-block border border-primary rounded-pill px-3 mb-3">@item.UnitPrice.ToString("0.00") ₺</div>
                                    <h3 class="mb-3">@item.ProductName</h3>
                                    <span>@item.Description</span>
                                </div>
                                <div class="position-relative mt-auto">
                                    <img class="img-fluid" src="@item.ImageUrl" alt="@item.ProductName" style="height:300px; width:420px;">
                                    <div class="product-overlay">
                                        <a class="btn btn-lg-square btn-outline-light rounded-circle" href="#"><i class="fa fa-eye text-primary"></i></a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                }
            </div>
        </div>
    </div>

    @* <div class="container-xxl bg-light my-6 py-6 pt-0">
        <div class="container">            
            <div class="text-center mx-auto mb-5 wow fadeInUp" data-wow-delay="0.1s" style="max-width: 500px;">                
                <h1 class="display-6 mb-4"> Tatlısından Tuzlusuna, Her Damak Zevkine Göre Ürünlerimiz</h1>
            </div>
            <div class="row g-4">
                @foreach (var item in Model)
                {
                    <div class="col-lg-4 col-md-6 wow fadeInUp" data-wow-delay="0.1s">
                        <div class="product-item d-flex flex-column bg-white rounded overflow-hidden h-100">
                            <div class="text-center p-4">
                                <div class="d-inline-block border border-primary rounded-pill px-3 mb-3">@item.UnitPrice.ToString("0.00") ₺</div>
                                <h3 class="mb-3">@item.ProductName</h3>
                                <span>@item.Description</span>
                            </div>
                            <div class="position-relative mt-auto">
                                <img class="img-fluid" src="@item.ImageUrl" alt="" style="height:300px; width:420px;">
                                <div class="product-overlay">
                                    <a class="btn btn-lg-square btn-outline-light rounded-circle" href="#"><i class="fa fa-eye text-primary"></i></a>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>     *@




    <!-- Product End -->
    <!-- Footer Start -->
    <div class="container-fluid bg-dark text-light footer my-6 mb-0 py-5 wow fadeIn" data-wow-delay="0.1s">
        <div class="container py-5">
            <div class="row g-5">
                <div class="col-lg-3 col-md-6">
                    <h4 class="text-light mb-4">Ofis Adresimiz</h4>
                    <p class="mb-2"><i class="fa fa-map-marker-alt me-3"></i>Ümraniye, İstanbul, TR</p>
                    <p class="mb-2"><i class="fa fa-phone-alt me-3"></i>+123 456 78 90</p>
                    <p class="mb-2"><i class="fa fa-envelope me-3"></i>info@bloombakery.com</p>
                    <div class="d-flex pt-2">
                        <a class="btn btn-square btn-outline-light rounded-circle me-1" href=""><i class="fab fa-twitter"></i></a>
                        <a class="btn btn-square btn-outline-light rounded-circle me-1" href=""><i class="fab fa-facebook-f"></i></a>
                        <a class="btn btn-square btn-outline-light rounded-circle me-1" href=""><i class="fab fa-youtube"></i></a>
                        <a class="btn btn-square btn-outline-light rounded-circle me-0" href=""><i class="fab fa-linkedin-in"></i></a>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <h4 class="text-light mb-4">Hızlı Bağlantılar</h4>
                    <a class="btn btn-link" href="">Hakkımızda</a>
                    <a class="btn btn-link" href="">Bize Ulaşın</a>
                    <a class="btn btn-link" href="">Hizmetlerimiz</a>
                    <a class="btn btn-link" href="">Şartlar & Koşullar</a>
                    <a class="btn btn-link" href="">Destek</a>
                </div>
                <div class="col-lg-3 col-md-6">
                    <h4 class="text-light mb-4">Fotoğraf Galerimiz</h4>
                    <div class="row g-2">
                        <div class="col-4">
                            <img class="img-fluid bg-light rounded p-1" src="/baker-1.0.0/img/product-1.jpg" alt="Image">
                        </div>
                        <div class="col-4">
                            <img class="img-fluid bg-light rounded p-1" src="/baker-1.0.0/img/product-2.jpg" alt="Image">
                        </div>
                        <div class="col-4">
                            <img class="img-fluid bg-light rounded p-1" src="/baker-1.0.0/img/product-3.jpg" alt="Image">
                        </div>
                        <div class="col-4">
                            <img class="img-fluid bg-light rounded p-1" src="/baker-1.0.0/img/product-2.jpg" alt="Image">
                        </div>
                        <div class="col-4">
                            <img class="img-fluid bg-light rounded p-1" src="/baker-1.0.0/img/product-3.jpg" alt="Image">
                        </div>
                        <div class="col-4">
                            <img class="img-fluid bg-light rounded p-1" src="/baker-1.0.0/img/product-1.jpg" alt="Image">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Footer End -->
    <!-- Copyright Start -->
    <div class="container-fluid copyright text-light py-4 wow fadeIn" data-wow-delay="0.1s">
        <div class="container">
            <div class="row">
                <div class="col-md-6 text-center text-md-start mb-3 mb-md-0">
                    &copy; <a href="#">Bloom Bakery</a>, Tüm hakları saklıdır.
                </div>
                <div class="col-md-6 text-center text-md-end">
                    <!--/*** This template is free as long as you keep the footer author’s credit link/attribution link/backlink. If you'd like to use the template without the footer author’s credit link/attribution link/backlink, you can purchase the Credit Removal License from "https://htmlcodex.com/credit-removal". Thank you for your support. ***/-->
                    <a href="https://htmlcodex.com">HTML Codex</a> tarafından tasarlandı
                    <br><a class="border-bottom" href="https://themewagon.com" target="_blank">ThemeWagon</a> tarafından dağıtıldı.
                </div>
            </div>
        </div>
    </div>
    <!-- Copyright End -->
    <!-- Back to Top -->
    <a href="#" class="btn btn-lg btn-primary btn-lg-square rounded-circle back-to-top"><i class="bi bi-arrow-up"></i></a>

    <!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/baker-1.0.0/lib/wow/wow.min.js"></script>
    <script src="/baker-1.0.0/lib/easing/easing.min.js"></script>
    <script src="/baker-1.0.0/lib/waypoints/waypoints.min.js"></script>
    <script src="/baker-1.0.0/lib/counterup/counterup.min.js"></script>
    <script src="/baker-1.0.0/lib/owlcarousel/owl.carousel.min.js"></script>

    <!-- Template Javascript -->
    <script src="/baker-1.0.0/js/main.js"></script>

    <script>
        const rangeMin = document.getElementById('rangeMin');
        const rangeMax = document.getElementById('rangeMax');
        const progress = document.getElementById('progress');
        const minPriceDisplay = document.getElementById('minPrice');
        const maxPriceDisplay = document.getElementById('maxPrice');
        const minPriceInput = document.getElementById('minPriceInput');
        const maxPriceInput = document.getElementById('maxPriceInput');
        const priceGap = 2; // Minimum 2₺ fark

        function updateSlider() {
            let minVal = parseInt(rangeMin.value);
            let maxVal = parseInt(rangeMax.value);

            if (maxVal - minVal < priceGap) {
                if (event.target.id === 'rangeMin') {
                    rangeMin.value = maxVal - priceGap;
                    minVal = maxVal - priceGap;
                } else {
                    rangeMax.value = minVal + priceGap;
                    maxVal = minVal + priceGap;
                }
            }

            const minPercent = (minVal / rangeMin.max) * 100;
            const maxPercent = (maxVal / rangeMax.max) * 100;
            progress.style.left = minPercent + '%';
            progress.style.width = (maxPercent - minPercent) + '%';

            minPriceDisplay.textContent = minVal;
            maxPriceDisplay.textContent = maxVal;
            minPriceInput.value = minVal;
            maxPriceInput.value = maxVal;
        }

        rangeMin.addEventListener('input', updateSlider);
        rangeMax.addEventListener('input', updateSlider);
        updateSlider();
    </script>


</body>

</html>
